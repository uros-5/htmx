(function(){var d;htmx.defineExtension("ws",{init:function(e){d=e;if(!htmx.createWebSocket){htmx.createWebSocket=t}if(!htmx.config.wsReconnectDelay){htmx.config.wsReconnectDelay="full-jitter"}},onEvent:function(e,t){switch(e){case"htmx:beforeCleanupElement":var n=d.getInternalData(t.target);if(n.webSocket){n.webSocket.close()}return;case"htmx:beforeProcessNode":var r=t.target;h(l(r,"ws-connect"),function(e){s(e)});h(l(r,"ws-send"),function(e){a(e)})}}});function i(e){return e.trim().split(/\s+/)}function r(e){var t=d.getAttributeValue(e,"hx-ws");if(t){var n=i(t);for(var r=0;r<n.length;r++){var s=n[r].split(/:(.+)/);if(s[0]==="connect"){return s[1]}}}}function s(a){if(!d.bodyContains(a)){return}var e=d.getAttributeValue(a,"ws-connect");if(e==null||e===""){var t=r(a);if(t==null){return}else{e=t}}if(e.indexOf("/")===0){var n=location.hostname+(location.port?":"+location.port:"");if(location.protocol==="https:"){e="wss://"+n+e}else if(location.protocol==="http:"){e="ws://"+n+e}}var o=c(a,function(){return htmx.createWebSocket(e)});o.addEventListener("message",function(e){if(m(a)){return}var t=e.data;if(!d.triggerEvent(a,"htmx:wsBeforeMessage",{message:t,socketWrapper:o.publicInterface})){return}d.withExtensions(a,function(e){t=e.transformResponse(t,null,a)});var n=d.makeSettleInfo(a);var r=d.makeFragment(t);if(r.children.length){var s=Array.from(r.children);for(var i=0;i<s.length;i++){d.oobSwap(d.getAttributeValue(s[i],"hx-swap-oob")||"true",s[i],n)}}d.settleImmediately(n.tasks);d.triggerEvent(a,"htmx:wsAfterMessage",{message:t,socketWrapper:o.publicInterface})});d.getInternalData(a).webSocket=o}function c(r,t){var s={socket:null,messageQueue:[],retryCount:0,events:{},addEventListener:function(e,t){if(this.socket){this.socket.addEventListener(e,t)}if(!this.events[e]){this.events[e]=[]}this.events[e].push(t)},sendImmediately:function(e,t){if(!this.socket){d.triggerErrorEvent()}if(!t||d.triggerEvent(t,"htmx:wsBeforeSend",{message:e,socketWrapper:this.publicInterface})){this.socket.send(e);t&&d.triggerEvent(t,"htmx:wsAfterSend",{message:e,socketWrapper:this.publicInterface})}},send:function(e,t){if(this.socket.readyState!==this.socket.OPEN){this.messageQueue.push({message:e,sendElt:t})}else{this.sendImmediately(e,t)}},handleQueuedMessages:function(){while(this.messageQueue.length>0){var e=this.messageQueue[0];if(this.socket.readyState===this.socket.OPEN){this.sendImmediately(e.message,e.sendElt);this.messageQueue.shift()}else{break}}},init:function(){if(this.socket&&this.socket.readyState===this.socket.OPEN){this.socket.close()}var n=t();d.triggerEvent(r,"htmx:wsConnecting",{event:{type:"connecting"}});this.socket=n;n.onopen=function(e){s.retryCount=0;d.triggerEvent(r,"htmx:wsOpen",{event:e,socketWrapper:s.publicInterface});s.handleQueuedMessages()};n.onclose=function(e){if(!m(r)&&[1006,1012,1013].indexOf(e.code)>=0){var t=f(s.retryCount);setTimeout(function(){s.retryCount+=1;s.init()},t)}d.triggerEvent(r,"htmx:wsClose",{event:e,socketWrapper:s.publicInterface})};n.onerror=function(e){d.triggerErrorEvent(r,"htmx:wsError",{error:e,socketWrapper:s});m(r)};var e=this.events;Object.keys(e).forEach(function(t){e[t].forEach(function(e){n.addEventListener(t,e)})})},close:function(){this.socket.close()}};s.init();s.publicInterface={send:s.send.bind(s),sendImmediately:s.sendImmediately.bind(s),queue:s.messageQueue};return s}function a(e){var t=d.getAttributeValue(e,"hx-ws");if(t&&t!=="send"){return}var n=d.getClosestMatch(e,o);u(n,e)}function o(e){return d.getInternalData(e).webSocket!=null}function u(g,v){var t=d.getInternalData(v);var e=d.getTriggerSpecs(v);e.forEach(function(e){d.addTriggerHandler(v,e,t,function(e,t){if(m(g)){return}var n=d.getInternalData(g).webSocket;var r=d.getHeaders(v,d.getTarget(v));var s=d.getInputValues(v,"post");var i=s.errors;var a=s.values;var o=d.getExpressionVars(v);var c=d.mergeObjects(a,o);var u=d.filterValues(c,v);var f={parameters:u,unfilteredParameters:c,headers:r,errors:i,triggeringEvent:t,messageBody:undefined,socketWrapper:n.publicInterface};if(!d.triggerEvent(e,"htmx:wsConfigSend",f)){return}if(i&&i.length>0){d.triggerEvent(e,"htmx:validation:halted",i);return}var l=f.messageBody;if(l===undefined){var h=Object.assign({},f.parameters);if(f.headers)h["HEADERS"]=r;l=JSON.stringify(h)}n.send(l,e);if(t&&d.shouldCancel(t,e)){t.preventDefault()}})})}function f(e){var t=htmx.config.wsReconnectDelay;if(typeof t==="function"){return t(e)}if(t==="full-jitter"){var n=Math.min(e,6);var r=1e3*Math.pow(2,n);return r*Math.random()}logError('htmx.config.wsReconnectDelay must either be a function or the string "full-jitter"')}function m(e){if(!d.bodyContains(e)){d.getInternalData(e).webSocket.close();return true}return false}function t(e){var t=new WebSocket(e,[]);t.binaryType=htmx.config.wsBinaryType;return t}function l(e,t){var n=[];if(d.hasAttribute(e,t)||d.hasAttribute(e,"hx-ws")){n.push(e)}e.querySelectorAll("["+t+"], [data-"+t+"], [data-hx-ws], [hx-ws]").forEach(function(e){n.push(e)});return n}function h(e,t){if(e){for(var n=0;n<e.length;n++){t(e[n])}}}})();